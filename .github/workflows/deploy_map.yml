name: Auto Build Map

on:
  push:
    branches:
      - main
    paths:
      - '**.xlsx'
      - '**.py'
      - 'requirements.txt'

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ä¸‹è¼‰å°ˆæ¡ˆ (Checkout)
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # æŠ“å–å®Œæ•´æ­·å²ï¼Œæœ‰åŠ©æ–¼è§£æ±ºè¡çª

      - name: è¨­å®š Python ç’°å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: å®‰è£å¥—ä»¶
        run: |
          pip install -r requirements.txt

      - name: åŸ·è¡Œè£½åœ–ç¨‹å¼
        run: |
          python testäº’å‹•å¼ç¶²é 5.py
          # è«‹ç¢ºèªé€™è£¡çš„æª”åè·Ÿä½ çš„ Python æª”åå®Œå…¨ä¸€è‡´

      - name: ç™¼å¸ƒåˆ° GitHub Pages
        run: |
          git config --global user.name "Map Bot"
          git config --global user.email "bot@github.com"
          
          # åŠ å…¥æ‰€æœ‰è®Šæ›´
          git add .
          
          # æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ›´
          if git diff --staged --quiet; then
            echo "âš ï¸ åµæ¸¬åˆ°æ²’æœ‰æª”æ¡ˆè®Šæ›´ï¼Œè·³éä¸Šå‚³æ­¥é©Ÿã€‚"
          else
            echo "âœ… åµæ¸¬åˆ°è®Šæ›´ï¼Œæº–å‚™ä¸Šå‚³..."
            git commit -m "Auto-update map: $(date +'%Y-%m-%d %H:%M')"
            
            # ğŸ”¥ é—œéµä¿®å¾©ï¼šä¸Šå‚³å‰å…ˆèˆ‡é ç«¯åŒæ­¥ï¼Œè§£æ±ºè¡çª
            git pull --rebase origin main
            
            git push origin main
          fi
